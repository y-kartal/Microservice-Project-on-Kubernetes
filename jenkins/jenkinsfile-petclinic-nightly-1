pipeline {
    agent any
    stages {
        stage('Deploy App on Kubernetes cluster') {
            steps {
                echo 'Deploying App on Kubernetes'
                sh "envsubst < k8s/petclinic_chart/values-template.yaml > /d/DevOps/Proje/Microservice-Project-on-Kubernetes/k8s/petclinic_chart/values.yaml"
                sh "sed -i '' 's/HELM_VERSION/${BUILD_NUMBER}/' /d/DevOps/Proje/Microservice-Project-on-Kubernetes/k8s/petclinic_chart/Chart.yaml"
                sh "helm repo add stable-petclinic s3://petclinic-helm-charts-yasinkartal/stable/myapp/"
                sh "helm package k8s/petclinic_chart"
                sh "helm s3 push --force petclinic_chart-${BUILD_NUMBER}.tgz stable-petclinic"
                sh "envsubst < ansible/playbooks/dev-petclinic-deploy-template > ansible/playbooks/dev-petclinic-deploy.yaml"
                sh "sleep 60"
                sh "ansible-playbook -i ./ansible/inventory/dev_stack_dynamic_inventory_aws_ec2.yaml ./ansible/playbooks/dev-petclinic-deploy.yaml"
            }
        }
    }
}

k8s\petclinic_chart\Chart.yaml